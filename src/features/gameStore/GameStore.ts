import { dimensionType } from "../../core/dimension.ts";
import {
    fromString,
    modelFns,
    modelType,
} from "../../game/model/mod.ts";

export type gameStateType = {
    readonly model: modelType;
    readonly dimensions: dimensionType;
    readonly gap: number;
    readonly size: number;
    readonly fps: number;
    readonly status: "resumed" | "paused";
};

export class GameStore {
    private model: modelType;
    private dimensions: dimensionType;
    private gap: number;
    private size: number;
    private fps: number;
    private status: "resumed" | "paused";

    constructor() {
        this.model = fromString([
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬜⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬜⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬜⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬜⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬜⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬜⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬜⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬜⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛",
            "⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛⬛",
        ]);
        this.dimensions = { width: 0, height: 0 };
        this.gap = 1;
        this.size = 20;
        this.fps = 1;
        this.status = "paused";
    }

    public pause(): void {
        this.status = "paused";
    }

    public resume(): void {
        this.status = "resumed";
    }

    public singleIteration(): void {
        this.model = modelFns.iterate(this.model);
        this.status = "paused";
    }

    public iterate(): void {
        this.model = modelFns.iterate(this.model);
    }

    public setDimensions(dimensions: dimensionType): void {
        this.dimensions = dimensions;
    }

    public setGap(gap: number): void {
        this.gap = gap;
    }

    public setSize(size: number): void {
        this.size = size;
    }

    public setFps(fps: number): void {
        this.fps = fps;
    }

    public getState(): gameStateType {
        return {
            model: this.model,
            dimensions: this.dimensions,
            gap: this.gap,
            size: this.size,
            fps: this.fps,
            status: this.status,
        };
    }
}
